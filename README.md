# Project Build and Management (`Project-make`)

## Overview

This repository, hereafter referred to as `Project-make`, provides a set of tools and workflows to manage a research project with distinct private and public versions. Its primary purpose is to automate the process of generating public-facing documents and materials from private, work-in-progress sources.

This setup is designed for projects where the source files (e.g., LaTeX documents, code, data) in a private repository need to be processed or sanitized before being released in a public repository. `Project-make` orchestrates this transformation.

## Directory Structure

The `Project-make` directory is intended to operate within a specific parent directory structure. Let's refer to the root project directory as `$PARENT`. The required structure is as follows:

```
$PARENT/
├── $PARENT-make/     (This repository)
├── $PARENT-Latest/   (Private repository with source files)
└── $PARENT-Public/   (Public repository for generated output)
```

### Roles of the Directories:

*   **`$PARENT`**: The top-level container for the entire project. Its name defines the project's base name. For example, if the project is called "MyProject", this directory would be `MyProject/`.

*   **`$PARENT-make`**: This directory contains the scripts, `Makefile`s, and other tools necessary to build the project. **This is the primary working directory** - build commands are typically executed from here. The scripts in this directory create, modify, and update files in `$PARENT-Latest`. It acts as the "control panel" for the entire project workflow.

*   **`$PARENT-Latest`**: This is the private "source" or "work-in-progress" repository. It contains all the project files, including notes, preliminary results, and full-detail LaTeX source files. **Files in this directory are created and modified by scripts running from `$PARENT-make`**. This directory is typically a private Git repository.

*   **`$PARENT-Public`**: This is the public "output" or "release" repository. It contains **sanitized versions** of documents and materials from `$PARENT-Latest`, with all private content removed, ready for public consumption. The contents of this directory are generated by the tools in `$PARENT-make` through a sanitization process. This directory is typically a public Git repository.

## Core Functionality and Workflow

The primary purpose of `Project-make` is to provide a systematic way to build the PDF and HTML versions of the project. The build process uses the source files located in `$PARENT-Latest`.

The sanitizing and copying of project outputs to the `$PARENT-Public` directory is a secondary function, performed only occasionally for testing or public release.

### Workflows

#### Primary Workflow (Development)
The main workflow involves **working from the `$PARENT-make` directory** and using its tools to:
1. Create and modify source files in `$PARENT-Latest` 
2. Compile outputs like PDFs from the LaTeX sources within `$PARENT-Latest`
3. These outputs are generated and reside within `$PARENT-Latest`

#### Secondary Workflow (Publication)
For a public release, a separate process is invoked from `$PARENT-make` to:
1. **Sanitize** the source files from `$PARENT-Latest` (e.g., remove private comments, notes, and sensitive material)
2. Generate the final outputs from the sanitized sources
3. Copy these clean, sanitized outputs to `$PARENT-Public` for public distribution

**Note**: `$PARENT-Public` contains a sanitized, public-ready version of `$PARENT-Latest` content, not merely compiled outputs.

## Complex Cross-Reference Handling

This system is specifically designed to handle **complex LaTeX projects with circular cross-references** between multiple documents. For example:
- A main paper that references appendix sections
- An appendix that cites figures/tables from the main paper  
- Multiple documents that reference each other's labels and citations

### Why Standard LaTeX Compilation Fails
Single `latexmk` runs are insufficient for these projects because:
- References may span multiple documents
- Circular dependencies require multiple compilation passes
- Bibliography processing must be coordinated across files

### The Triple-Compilation Solution
The `reproduce_document_pdfs.sh` script performs:
```bash
latexmk -c           # Clean auxiliary files
latexmk              # First pass: generate .aux files, process bibliography  
latexmk              # Second pass: resolve most cross-references
latexmk              # Third pass: finalize remaining references
```

This ensures all cross-references, citations, and table of contents are properly resolved.

### Configuration System
The system uses **modular LaTeX configuration**:
- `.latexmkrc` - Main configuration that imports specialized modules
- `.latexmkrc_for-projects-with-circular-crossrefs` - Handles complex reference scenarios
- `.latexmkrc_using-bibtex-wrapper` - Custom bibliography processing

Users can customize compilation via the `LATEX_OPTS` environment variable:
```bash
LATEX_OPTS="-interaction=batchmode" ./reproduce_document_pdfs.sh
```

## For AI Assistants

This `README.md` provides context for understanding a **complex LaTeX project build system** designed for academic papers with circular cross-references. Key capabilities:

- **Multi-document compilation** with cross-reference resolution
- **Modular configuration system** using importable `.latexmkrc` files  
- **Environment variable customization** via `LATEX_OPTS`
- **Automated script generation** for reproducible builds
- **Undefined reference detection** with user guidance

The core concept is separation of concerns: private workspace (`-Latest`), public distribution (`-Public`), and build orchestration (`-make`), with sophisticated handling of LaTeX compilation complexity.# HAFiscal-Public
