% -*- TeX -*-
\Preamble{pic-equation,pic-align,pic-tabular}
\RequirePackage{amsmath}
\RequirePackage{amssymb}
\RequirePackage{hyperref}

\DeclareGraphicsExtensions{.png,.svg,.jpg} % changed to prefer png over svg for reliable image display
%\DeclareGraphicsRule{.png}{bmp}{.xbb}{} % FIXED: was overriding SVG preference

% <includegraphics-sizing/>
% <graphics-svg>

% FIX: Define two-digit formatting for tex4ht (moved before document)
\makeatletter
% Define a tex4ht-compatible two-digit formatter
\def\twodigits#1{\ifnum#1<10 0\fi\number#1}
\makeatother

% SVG-specific configuration disabled - reverting to PNG for reliable image display
%\makeatletter
%% Configure basic image handling
%\Configure{graphics*}
%  {svg}
%  {%
%    {\Configure{Needs}{File: \Gin@base.svg}\Needs{}}%
%    \Picture[\csname a:GraphicsAlt\endcsname]{\csname Gin@base\endcsname.svg
%      \space style="width:\expandafter\the\csname Gin@req@width\endcsname;"
%    }%
%  }
%\makeatother

% Add CSS for figure styling
\Css{figure.figure img {
    max-width: 90%;
    width: auto;
    height: auto;
    margin: 0 auto;
}}
\Css{.subfigure {
    display: inline-block !important;
    width: 50% !important;
    max-width: 50% !important;
    margin: 0 !important;
    vertical-align: top !important;
}}

% Center subfigure and main figure captions
\Css{.subfigure figcaption {
    margin-top: 0.5em;
    text-align: center;
}}

% Override theme caption styles with maximum specificity
\Css{div.subfigure .caption .content,
figcaption .content,
.caption .content {
    text-align: center !important;
}}

% Additional high-priority centering rules
\Css{div.subfigure .caption .content,
body div.subfigure .caption .content,
html body div.subfigure .caption .content {
    text-align: center !important;
}}

% Ensure figures with subfigures are properly centered
\Css{figure.figure {
    text-align: center;
    width: 100%;
    margin: 1em auto;
  }}
% <graphics-svg/>
% <includegraphics-sizing/>

% <config-eqns>
% Styling for numbered equations
% This puts the SVG in a three element table
% where the first and last elements are of size 0.01
% so that the middle element will be centered
\Css{.equation{
    display: table;
    margin-top: 1.5em;
    margin-bottom: 1.5em;
}}
\Css{.equation td:first-child{
    text-align: center;
    vertical-align: middle;
}}
\Css{.equation td:last-child{
    text-align: right;
    vertical-align: middle;
}}

% For unnumbered equations - with the same vertical margins
\Css{.equation-star{
    display: block;
    text-align: center;
    margin-top: 1.5em;
    margin-bottom: 1.5em;
}}

% Common styling for both types
\Css{.math-display img{ /* Targets images within elements with class math-display */
    display: block;     /* Makes the image a block element */
    margin-left: auto;  /* These two margin settings together */
    margin-right: auto; /* center the image horizontally */
  }
}
  
% Simple configuration for class 'equation-star'
\Configure{equation*}                   % Configure unnumbered equations
{                                       % Beginning code
    \ifvmode\IgnorePar\fi\EndP          % Handle vertical mode and paragraph endings
    \HCode{<div class="equation-star">} % Start a div with class="equation-star"
}
{                                       % Ending code
    \HCode{</div>}                      % Close the div
  }
  % <config-eqns/>
% <20250809>: claude-sonnet-3p7: I am using make4ht to generate an html version of Paramterization.tex.  It mostly works, but the citations in the parbox at the bottom of the figure 'fig:untargetedMoments' cause line breaks in the html code (but not in the pdf).  How can I fix this?  
%\ConfigureEnv{figure}{\ifvmode\IgnorePar\fi\EndP\HCode{<div class="figure">}}{\ifvmode\Ig%norePar\fi\EndP\HCode{</div>}}{}{}
%\Css{.figure .citation {display: inline;}}
%\Css{.figure .parbox {display: block; margin-top: 0.5em;}}
% </20250809>

\Css{
div.center p {
  text-align: justify !important;
  margin: 0.5em 0;
}
}

% Semantic table commands are HTML-aware from local.sty
% CSS for semantic table classes

% CSS for semantic table classes
\Css{
.panel-header-center {
  text-align: center !important;
  font-weight: bold;
  margin: 0.8em auto;
  display: block;
}

.table-footer-justified {
  max-width: 75%;
  margin: 1em auto;
  text-align: justify;
  font-size: 85%;
  line-height: 1.4;
  display: block;
}
}

% TABLE FORMATTING FIXES - 20250911 - Updated approach
% Fix 1: Center table captions with higher specificity
\Css{
figcaption.caption {
    text-align: center !important;
    margin: 1rem auto !important;
    display: block !important;
}

figcaption.caption .id {
    text-align: center !important;
    display: block !important;
    font-weight: bold !important;
    margin-bottom: 0.5rem !important;
}

figcaption.caption .content {
    text-align: center !important;
    display: block !important;
}
}

% Fix 2: Target the specific text nodes that appear as panel headers
% Based on the HTML structure: plain text appears between figcaption and table
\Css{
/* Target text that appears directly after figcaption in figure.float */
figure.float > span.ec-lmr-6 + *:not(table):not(p.noindent) {
    text-align: center !important;
    font-weight: bold !important;
    margin: 1em auto 0.5em auto !important;
    display: block !important;
}

/* Alternative: target any direct text content in figure.float */
figure.float {
    text-align: center;
}

figure.float > text,
figure.float > *:not(figcaption):not(table):not(.tabular):not(p) {
    text-align: center !important;
    font-weight: bold !important;
    margin: 1em auto 0.5em auto !important;
    display: block !important;
}
}

% Fix 3: Better table note formatting and positioning
\Css{
/* Target multicolumn notes within tables */
.multicolumn {
    text-align: justify !important;
    max-width: 100% !important;
    margin: 0.5em 0 !important;
    font-size: 0.9em !important;
    line-height: 1.4 !important;
}

.multicolumn .ec-lmbx-10 {
    font-weight: bold !important;
}

.multicolumn .ec-lmr-10 {
    font-weight: normal !important;
}

/* Ensure table notes appear after the table content */
tr:last-child .multicolumn {
    margin-top: 1em !important;
}
}

% Fix 4: General table improvements
\Css{
.tabular {
    margin: 0.5em auto 1em auto !important;
    border-collapse: collapse !important;
    width: auto !important;
}

.tabular td {
    padding: 0.3em 0.5em !important;
    vertical-align: top !important;
}

/* Ensure proper spacing between table elements */
figure.float .tabular + p.noindent {
    margin-top: 1.5em !important;
    text-align: center !important;
    font-weight: bold !important;
}
}

% Custom CSS for \fbox{} styling - centered table headers without borders
\Css{.fbox {
    border: none !important;
    text-align: center !important;
    font-weight: normal !important;
    padding: 0 !important;
    display: block !important;
    margin: 0.5em auto !important;
}}

% Custom CSS to remove borders from tabbing tables (fix for faint border issue)
\Css{table.tabbing {
    border: none !important;
}}

\begin{document}

% Apply date configuration with our custom formatter
% \Configure{date}{}{\the\year-\twodigits{\month}-\twodigits{\day}}       % ISO date - COMMENTED OUT: was causing spurious output in HTML head

% Override tex4ht's built-in meta date tag to prevent spurious output in HTML head
% The system html4.4ht includes: {\HCode{<meta name="date" content="\:today"\xml:empty>\Hnewline}}
% This causes raw date text to appear in HTML head, so we override it with empty content
\Configure{META}{}{}

\EndPreamble
